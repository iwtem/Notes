## SPA 与 MPA

### SPA

SPA 即 Single Page Application 的缩写，意为单页面应用。

第一次进入页面的时候，会请求一个 `html` 文件。当点击页面上的元素跳转到其他页面，此时浏览器的路径发生变化，页面内容随之发生变化，但是并不会产生新的 `html` 文件的请求。具体工作原理是在前端通过监控 `Url` 的变化，动态调整显示对应的 `Url` 下的组件，卸载不需要的组件，页面无需刷新，只会进行部分页面的替换。

#### SPA 的优势

- **按需更新**

  SPA 路由跳转时基于特定的实现（如 `vue-router`，`react-router` 等前端路由），而非原生浏览器的文档跳转（`navigating across documents`）。那么即可实现按需进行页面中的必要的组件级更新，而非无差别式页面级更新。

- **页面切换快**

  SPA 不需要刷新整个页面，所以页面切换之间的间隙更短，使应用更加流畅，接近原生应用的性能优势与体验。

- **组件复用**

  因为页面是进行组件级别的更新，所以页面中的其他组件可以保持复用，因此更适合快速迭代的产品。

- **后端解耦**

  基于 SPA 前端路由的控制，使得 SPA 与应用后端解耦，不再依赖于后端的路由分配，完成前后端分离。

#### SPA 的弊端

- **不利于 SEO**

  SPA 应用在初始时是由一个空白的页面，进入到有内容的页面。而搜索引擎的算法抓取结果仅限于初次请求时返回的页面，不会等待 SPA 进行内容的填充。所以纯粹的 SPA 是不利于搜索引擎优化（SEO）。

- **首屏加载慢**

  SPA 是整个应用页面，那么在未优化前端路由加载时，应用初始首屏即需要下载整个应用。其中可能会包含用户不会访问的页面。（这一点可以通过动态路由加载解决。）

#### SPA 的优化

- **SSR 服务端渲染**

  纯粹的 SPA 是从空白页面进行应用初始化。基于一般搜索引擎算法，从空白页面进行应用初始化是不利于 SEO 的。通过 SSR 服务端渲染，在服务端生成处理好的 Html 页面再返回到客户端，这样解决了空白页面的问题，达到 SEO 优化的目的。当然，SSR 也会增加服务器的压力。

  当然也存在一个 SPA 的特例，即**静态页面内容**的 SPA。因为静态内容的不可变性，可以再服务端进行静态内容**预渲染（`pre-render`）**，以此来减轻服务端不必要的即时页面服务端渲染需求的性能压力。预渲染的一种实现是使用 `Chrome` 浏览器的无界面 `API` [puppeteer](https://github.com/GoogleChrome/puppeteer) 并配合 [prerender-spa-plugin](https://github.com/chrisvfritz/prerender-spa-pluginSSR) 来实现静态内容的预渲染。在完成预渲染之后，即可得到 ***有状态*** 的 `SPA`，之后再将生成的页面部署在静态服务器上即可。此时这部分静态内容就避免了即时的 `SSR`。

- **动态加载路由**

  如果未对 SPA 应用进行优化，那么进行应用初始化时，就需要加载该页面下的所有子路由组件，大大增加了首屏时间。SPA 首屏优化策略是通过使用**动态加载路由组件**，即在应用初次加载时，不进行加载所有的子路由组件，而是在用户访问对应的子路由时，再下载相应的子路由组件。

  通过这样处理，就可以将首屏下载各个子路由组件的时间分摊到各个子路由自身，不用在首屏中进行集中处理。



### MPA

MPA 即 Multiple Page Application 的缩写，意为多页面应用，与 `SPA` 对比最大的不同即是页面路由切换由原生浏览器文档跳转（`navigating across documents`）控制。

每一次页面跳转的时候，后台服务器都会给返回一个新的 html 文档，这也意味着每次的跳转都会重新加载整个页面，这种跳转方式这种类型的网站也就是多页网站，也叫做多页应用。

#### MPA 的优势

- **页面解耦**

  因为 MPA 各个页面相互独立，可以将每一个页面都看做一个单一的微服务。各个页面之间达到相互独立于解耦的目的。

- **去中心化**

  因为其解耦的特性，因而更加适合前端去中心化的复杂 web 应用。

#### MAP 的弊端

- **页面重载**

  MPA 路由基于原生浏览器的文档跳转（`navigating across documents`）。因此每一次的页面更新都是一次页面重载，这将带来巨大的重启性能消耗。

- **前端不分离**

  MPA 的前端页面与后端是一一对应，耦合的。在开发时，增加了开发成本，前后端开发进度必须统一协作。



### SPA 与 MPA 的对比

|                          | MPA                                              | SPA                                                          |
| ------------------------ | ------------------------------------------------ | ------------------------------------------------------------ |
| 应用构成                 | 多个完整页面构成                                 | 一个外壳页面和多个页面片段构成                               |
| 刷新方式                 | 整体刷新                                         | 部分替换                                                     |
| 跳转公共资源是否重新加载 | 是                                               | 否                                                           |
| URL 模式                 | http://xxx/page1.htlm<br />http://xxx/page2.html | http://xxx/index.html#/page1<br />http://xxx/index.html#/page2 |
| 用户体验                 | 页面之间切换慢，不流畅，体验差                   | 页面之间切换快，体验好                                       |
| 转场动画                 | 无法实现                                         | 容易实现                                                     |
| 页面数据传递             | 依赖 URL、cookie、localstorage                   | 容易实现，比如 redux                                         |
| 搜索引擎优化 SEO         | 可直接做                                         | 单独方案，比如 SSR                                           |
| 适用范围                 | 需要对搜索引擎友好的网站                         | 体验要求高的网站                                             |

